import"../chunks/DsnmJJEf.js";import"../chunks/BFNGBcc7.js";import{o as Cs}from"../chunks/CJgI0qws.js";import{p as ls,Q as es,V as b,t as T,R as As,O as r,o as e,P as l,M as o,y as L,u as ws,a as ds,U as _,aE as ts,e as Is,$ as Ns,W as $s}from"../chunks/9-_W6_Jj.js";import{p as Q,s as D,e as f}from"../chunks/Cv-eKTXv.js";import{i as H,d as m,f as y,s as Ps,b as g,c as $,e as Ls}from"../chunks/DMh7ZjmC.js";import{t as as,d as zs,e as U,A as ns,a as os,f as Os,h as Bs,o as Ms,g as Rs,i as q}from"../chunks/ha-UOQYi.js";import{h as Gs}from"../chunks/D50xvMqx.js";import{b as rs}from"../chunks/Cnjqa8SA.js";import{i as ps}from"../chunks/Cjo9otzO.js";import{g as P}from"../chunks/B-gExwhp.js";import{G as Ts,g as Us,a as qs}from"../chunks/QimkSIxU.js";import{d as w,e as E,f as is,s as cs}from"../chunks/C48CS4ZV.js";var Es=y('<img class="sp-card-img svelte-1gumkr9" alt="skin portrait" loading="lazy" referrerpolicy="no-referrer"/>'),Qs=y('<div class="sp-card svelte-1gumkr9" role="button" tabindex="0"><!> <div class="sp-card-footer svelte-1gumkr9"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 7v6l4 2" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="12" cy="12" r="9" stroke="white" stroke-width="1.2" fill="none"></circle></svg> <span> </span></div></div>');function Ds(x,h){ls(h,!1);const d=_(),a=_();let i=Q(h,"item",24,()=>({})),j=Q(h,"onClick",8,()=>{});es(()=>T(i()),()=>{b(d,i()?.report_data?.input?.image||"")}),es(()=>T(i()),()=>{b(a,i()?.report_data?.createdAt||i()?.created_at||"")}),As(),ps();var p=Qs(),I=r(p);{var S=u=>{var k=Es();L(()=>zs(k,"src",e(d))),f("error",k,z=>{z.target.style.display="none"}),m(u,k)};H(I,u=>{e(d)&&u(S)})}var c=l(I,2),C=l(r(c),2),N=r(C,!0);o(C),o(c),o(p),L(u=>D(N,u),[()=>(T(as),e(a),ws(()=>as(e(a))))]),f("click",p,()=>j()(i())),m(x,p),ds()}var Hs=y('<div class="analysis-banner svelte-16hxtck"><button class="analysis-btn svelte-16hxtck" type="button"><span class="analysis-btn-icon svelte-16hxtck" aria-hidden="true"></span> <span class="analysis-btn-text">Analyze</span></button></div>');function Ws(x,h){let d=Q(h,"onAnalyze",8,()=>{});var a=Hs(),i=r(a);o(a),f("click",i,function(...j){d()?.apply(this,j)}),m(x,a)}var Js=y('<div class="sp-grid svelte-gp6j5s" style="display: block;"><div class="sp-card-scroller svelte-gp6j5s"></div></div>'),Ks=y('<button class="sp-chip svelte-gp6j5s" type="button"> </button>'),Vs=y('<button class="sp-q svelte-gp6j5s" type="button"> </button>'),Ys=y(`<section class="sp-screen is-open svelte-gp6j5s"><div class="sp-header svelte-gp6j5s"><button class="sp-back svelte-gp6j5s" type="button" aria-label="Back"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="sp-title svelte-gp6j5s">Skin Portrait</div></div> <div class="sp-content svelte-gp6j5s"><div class="sp-title-content svelte-gp6j5s"><h2 class="sp-h2 svelte-gp6j5s">Your skin analysis</h2> <button class="sp-add svelte-gp6j5s" type="button" aria-label="Add"><svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></button></div> <!> <div class="sp-concerns"><h3 class="sp-h3 svelte-gp6j5s">Let's support your skin!</h3> <p class="sp-sub svelte-gp6j5s">These areas could benefit from extra care:</p> <div class="sp-chips svelte-gp6j5s"></div></div> <div class="sp-questions-info"><h3 class="sp-h3 svelte-gp6j5s">Have a skin concern?</h3> <p class="sp-sub svelte-gp6j5s">Start with a question!</p></div> <div class="sp-questions svelte-gp6j5s"><!> <button class="sp-q svelte-gp6j5s" type="button">Ask more...</button></div></div></section> <!>`,1);function de(x,h){ls(h,!1);const d=()=>$(cs,"$subjectId",p),a=()=>$(w,"$scansPaging",p),i=()=>$(E,"$scanItems",p),j=()=>$(is,"$selectedConcerns",p),[p,I]=Ps();let S=_(),c=_(),C=_(!1),N=_(["Pores","Hydration","Uniformness"]),u=_([]);Cs(async()=>{if(b(u,Bs(Ms)),!d())try{const s=Rs(),t=await qs(ns,s,os);g(cs,t.subjectId)}catch(s){console.error("getSubjectId failed:",s)}d()&&(await k(!0),z())});async function k(s=!1){if(!a().isLoading&&!(!a().hasNext&&!s)){s&&(g(w,{pageNo:1,pageSize:10,isLoading:!1,hasNext:!0}),g(E,[])),g(w,{...a(),isLoading:!0});try{const t=await Us(ns,d(),os,a().pageNo,a().pageSize),n=t?.items||[];g(E,[...i(),...n]),g(w,{...a(),hasNext:t?.page?.hasNext,pageNo:a().pageNo+1,isLoading:!1}),s&&n.length&&W(n[0]),b(C,i().some(v=>{const A=v?.report_data?.input?.image;return typeof A=="string"&&A.trim()}))}catch(t){console.error("getScans failed:",t),g(w,{...a(),isLoading:!1})}}}function z(){e(c)&&e(c).addEventListener("scroll",()=>{if(a().isLoading||!a().hasNext)return;e(c).scrollWidth-(e(c).scrollLeft+e(c).clientWidth)<240&&a().hasNext&&k()})}function W(s){const t=Os(s);b(N,[t[0]||"Pores",t[1]||"Hydration",t[2]||"Uniformness"]);const n=s?.report_data?.output?.skinData?.concerns||[];g(is,n)}function vs(s){W(s),typeof sessionStorage<"u"&&sessionStorage.setItem("skinPortraitResult",JSON.stringify(s)),P("/skin-portrait/result")}function us(s){j().length&&(typeof sessionStorage<"u"&&sessionStorage.setItem("concernData",JSON.stringify({concerns:j(),selectedName:s})),P("/concern"))}function gs(){e(S)?.showGlamARSdk()}function fs(){e(S)?.showGlamARSdk()}async function J(s){P("/")}function ms(){P("/")}ps();var K=Ys();Gs("gp6j5s",s=>{Is(()=>{Ns.title="Skin Portrait | SkinGPT"})});var O=ts(K),B=r(O),hs=r(B);$s(2),o(B);var V=l(B,2),M=r(V),ks=l(r(M),2);o(M);var Y=l(M,2);{var bs=s=>{var t=Js(),n=r(t);U(n,5,i,q,(v,A)=>{var ss=Ls(),Ss=ts(ss);{var xs=G=>{Ds(G,{get item(){return e(A)},onClick:vs})};H(Ss,G=>{e(A)?.report_data?.input?.image&&G(xs)})}m(v,ss)}),o(n),rs(n,v=>b(c,v),()=>e(c)),o(t),m(s,t)},_s=s=>{Ws(s,{onAnalyze:gs})};H(Y,s=>{e(C)?s(bs):s(_s,!1)})}var R=l(Y,2),F=l(r(R),4);U(F,5,()=>e(N),q,(s,t)=>{var n=Ks(),v=r(n,!0);o(n),L(()=>D(v,e(t))),f("click",n,()=>us(e(t))),m(s,n)}),o(F),o(R);var X=l(R,4),Z=r(X);U(Z,1,()=>e(u),q,(s,t)=>{var n=Vs(),v=r(n,!0);o(n),L(()=>D(v,e(t))),f("click",n,()=>J(e(t))),m(s,n)});var ys=l(Z,2);o(X),o(V),o(O);var js=l(O,2);rs(Ts(js,{onScanComplete:()=>k(!0),onConcernOpen:()=>{},$$legacy:!0}),s=>b(S,s),()=>e(S)),f("click",hs,ms),f("click",ks,fs),f("click",ys,()=>J()),m(x,K),ds(),I()}export{de as component};
