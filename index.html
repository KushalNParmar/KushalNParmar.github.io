<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkinGPT | GlamAR</title>

    <style>
      /* ---------- Design tokens (tuned to match reference) ---------- */
      :root {
        /* Page */
        --c-page: #ffffff;
        --c-glow-blue: rgba(115, 165, 255, 0.18);
        --c-glow-violet: rgba(170, 120, 255, 0.18);
        --c-glow-pink: rgba(255, 170, 220, 0.1);

        --c-glow-blue-dark: rgba(115, 165, 255, 0.4);
        --c-glow-violet-dark: rgba(170, 120, 255, 0.25);
        --c-glow-pink-dark: rgba(255, 170, 220, 0.2);

        /* Brand title */
        --c-title: #4d73ff;
        --c-subtitle: rgba(77, 115, 255, 0.75);

        /* Text */
        --c-text: #0b0b10;
        --c-muted: rgba(11, 11, 16, 0.55);

        /* Panel */
        --c-panel: rgba(255, 255, 255, 0.85);
        --c-panel-border: rgba(170, 170, 190, 0.35);
        --c-panel-shadow: rgba(65, 55, 160, 0.1);

        /* Composer */
        --c-composer-bg: rgba(255, 255, 255, 0.9);
        --c-composer-border: rgba(190, 190, 210, 0.45);
        --c-focus-ring: rgba(120, 150, 255, 0.22);

        /* Chips */
        --c-chip: rgba(105, 145, 255, 0.18);
        --c-chip-hover: rgba(105, 145, 255, 0.24);
        --c-chip-text: rgba(11, 11, 16, 0.78);

        /* Send */
        --c-send-bg: rgba(11, 11, 16, 0.06);
        --c-send-border: rgba(11, 11, 16, 0.08);
        --c-send-icon: rgba(11, 11, 16, 0.6);

        /* Lavender band behind cards */
        --c-band: rgba(160, 140, 255, 0.16);

        /* Cards */
        --c-card: rgba(255, 255, 255, 0.92);
        --c-card-border: rgba(190, 190, 210, 0.4);
        --c-card-shadow: rgba(65, 55, 160, 0.08);
        --c-img-bg: rgba(120, 170, 255, 0.12);

        /* Radii */
        --r-panel: 1.35rem;
        --r-lg: 1.1rem;
        --r-md: 0.9rem;
        --r-pill: 999rem;
      }

      /* ---------- Base (mobile-first: 320x640) ---------- */
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        color: var(--c-text);

        /* No scrolling */
        height: 100svh;
        overflow: hidden;
        overscroll-behavior: none;

        background: var(--c-page);
        /* Reference-like soft ambient glow */
        background-image:
          radial-gradient(
            70rem 45rem at 20% 18%,
            var(--c-glow-blue),
            transparent 62%
          ),
          radial-gradient(
            70rem 45rem at 80% 22%,
            var(--c-glow-pink),
            transparent 62%
          ),
          radial-gradient(
            80rem 55rem at 50% 88%,
            var(--c-glow-violet),
            transparent 68%
          );
      }

      main {
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 1.25rem 1rem;
        gap: 1.1rem;
        min-height: 0;
      }

      .hero-title {
        margin: 0;
        font-size: 2.6rem;
        font-weight: 800;
        text-align: center;
        line-height: 1.02;
        letter-spacing: -0.02em;
        color: var(--c-title);
      }

      .hero-subtitle {
        margin: 0.35rem 0 0;
        font-size: 0.95rem;
        text-align: center;
        color: var(--c-subtitle);
      }

      /* ---------- Panel (outer rounded container) ---------- */
      .panel {
        width: 100%;
        max-width: 40rem;
        border-radius: var(--r-panel);
        /* background: var(--c-panel); */
        border: 0.0625rem solid var(--c-panel-border);
        box-shadow: 0 1.5rem 3.2rem -2rem var(--c-panel-shadow);
        overflow: hidden;
        background: linear-gradient(
          180deg,
          transparent 0%,
          rgba(160, 140, 255, 0.08) 2%,
          var(--c-band) 100%
        );
      }

      .panel-inner {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* ---------- Composer (top area) ---------- */
      .composer-inner {
        border-bottom: 0.0625rem solid var(--c-composer-border);
        border-radius: var(--r-lg);
        background: var(--c-composer-bg);
        padding: 0.95rem;
        display: grid;
        grid-template-rows: auto auto;
        gap: 0.75rem;
      }

      .composer-input {
        width: 100%;
        resize: none;
        border: 0;
        outline: none;
        background: transparent;
        color: rgba(11, 11, 16, 0.72);
        font-size: 1.05rem;
        line-height: 1.35;

        max-height: 7.2rem; /* ~5 lines */
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        min-height: 1.35rem;
      }

      .composer-input::placeholder {
        color: rgba(11, 11, 16, 0.38);
      }

      .composer-bottom {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 0.9rem;
        align-items: end;
      }

      /* chips stacked vertically like reference */
      .chips {
        display: flex;
        flex-direction: row;
        gap: 0.55rem;
        align-items: flex-start;
        min-width: 0;
      }

      .suggestion-btn {
        background: var(--c-chip);
        border: 0;
        color: var(--c-chip-text);
        padding: 0.62rem 0.95rem;
        border-radius: var(--r-pill);
        font-size: 0.9rem;
        cursor: pointer;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .suggestion-btn:hover {
        background: linear-gradient(
          120deg,
          var(--c-glow-blue-dark) 50%,
          var(--c-glow-violet-dark) 100%
        );
      }

      /* Send button: grey circle with UP arrow */
      /* CTA default = inactive */
      .cta {
        width: 2.85rem;
        height: 2.85rem;
        border-radius: var(--r-pill);
        background: var(--c-send-bg);
        border: 0.0625rem solid var(--c-send-border);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        flex: 0 0 auto;
        transition:
          background 180ms ease,
          border-color 180ms ease;
      }

      /* inactive look */
      .cta[disabled],
      .cta.is-disabled {
        opacity: 1;
        cursor: default;
      }

      /* active look (black bg, white arrow) */
      .cta.is-active {
        background: #0b0b10;
        border-color: #0b0b10;
      }

      .cta svg {
        width: 1.15rem;
        height: 1.15rem;
        color: var(--c-send-icon);
        transition: color 180ms ease;
      }

      .cta.is-active svg {
        color: #ffffff;
      }

      .cta svg {
        width: 1.15rem;
        height: 1.15rem;
        color: var(--c-send-icon);
      }

      /* ---------- Lower lavender band + feature cards ---------- */
      .panel-band {
        /* background: linear-gradient(
          180deg,
          transparent 0%,
          rgba(160, 140, 255, 0.08) 2%,
          var(--c-band) 100%
        ); */
        padding: 0.95rem 1.05rem 1.05rem;
      }

      .features-container {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.95rem;
      }

      /* ---------- Feature card hover + keyboard focus animation (restore) ---------- */
      .feature-card {
        background: var(--c-card);
        border: 0.0625rem solid var(--c-card-border);
        border-radius: var(--r-lg);
        padding: 0.9rem;
        cursor: pointer;
        box-shadow: 0 1.2rem 2.4rem -2rem var(--c-card-shadow);

        /* restore animation */
        transition:
          transform 220ms ease,
          box-shadow 220ms ease,
          border-color 220ms ease;
        will-change: transform, box-shadow;
      }

      .feature-card:hover {
        transform: translateY(-0.18rem);
        box-shadow:
          0 1.8rem 3.6rem -2.2rem rgba(65, 55, 160, 0.18),
          0 0.75rem 1.6rem -1.2rem rgba(65, 55, 160, 0.12);
      }

      /* keyboard accessibility */
      .feature-card:focus-visible {
        outline: none;
        transform: translateY(-0.12rem);
        box-shadow:
          0 0 0 0.25rem var(--c-focus-ring),
          0 1.8rem 3.6rem -2.2rem rgba(65, 55, 160, 0.18);
      }

      /* Optional: nicer press feel */
      .feature-card:active {
        transform: translateY(-0.06rem) scale(0.995);
      }

      .feature-image {
        width: 100%;
        height: 7.4rem;
        border-radius: var(--r-md);

        object-fit: contain;
        display: block;
        padding: 0.35rem;
        margin-bottom: 0.85rem;
      }

      .feature-title {
        margin: 0 0 0.22rem;
        font-size: 1rem;
        font-weight: 800;
        color: rgba(11, 11, 16, 0.86);
      }

      .feature-description {
        margin: 0;
        font-size: 0.92rem;
        color: rgba(11, 11, 16, 0.55);
      }

      /* ---------- Skin Portrait pill (center below panel) ---------- */
      .skin-portrait-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.7rem;
        padding: 0.1rem 1rem 0.1rem 0.1rem;
        border-radius: var(--r-pill);

        /* border: 0.0625rem solid rgba(170, 170, 190, 0.35); */
        box-shadow: 0 1.4rem 2.8rem -2.2rem rgba(65, 55, 160, 0.12);
        text-decoration: none;
        color: rgba(11, 11, 16, 0.8);
        background: linear-gradient(
          120deg,
          #c7666699 0%,
          rgb(255 255 255 / 30%) 0%,
          rgb(255 255 255) 100%
        );
      }

      .skin-portrait-pill:hover {
        background: linear-gradient(
          120deg,
          var(--c-glow-blue) 50%,
          var(--c-glow-violet) 100%
        );
      }

      .skin-portrait-plus {
        width: 3.05rem;
        height: 3.05rem;
        border-radius: var(--r-pill);
        background: white;
        /* border: 0.0625rem solid rgba(11, 11, 16, 0.08); */
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex: 0 0 auto;
      }

      .skin-portrait-plus svg {
        width: 1rem;
        height: 1rem;
        color: rgba(11, 11, 16, 0.6);
      }

      .skin-portrait-text {
        font-size: 0.95rem;
        font-weight: 650;
        color: rgba(11, 11, 16, 0.75);
      }

      /* ---------- Copilot / Overlay (keep yours) ---------- */
      #copilotContainer {
        position: fixed;
        inset: 0;
        z-index: 10;
        background: #fff;
        display: flex;
      }
      #copilotSA {
        width: 100%;
        height: 100%;
      }
      #glamarOverlay {
        position: fixed;
        inset: 0;
        z-index: 999999;
        background: rgba(0, 0, 0, 0.65);
        display: none;
        align-items: center;
        justify-content: center;
      }
      #glamarModal {
        position: relative;
        width: 100%;
        height: 100%;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
      }
      #GlamAR-Container {
        width: 100%;
        height: 100%;
        background: #fff;
        overflow: hidden;
      }

      .loader {
        width: 100%;
        height: 100%;
        background: #00000052;
        position: fixed;
        z-index: 1000000;
        display: none;
        align-items: center;
        justify-content: center;
      }
      .loader.active {
        display: flex;
      }
      .loader svg {
        max-width: 200px;
        max-height: 200px;
      }

      /* ---------- Required media queries ---------- */

      @media (min-width: 648px) {
        main {
          padding: 1.75rem 1.5rem;
          gap: 1.4rem;
        }

        .hero-title {
          font-size: 3.1rem;
        }

        .hero-subtitle {
          font-size: 1.05rem;
        }

        /* .panel {
          max-width: 44rem;
        } */

        .panel-band {
          padding: 1.1rem 1.25rem 1.25rem;
        }

        .features-container {
          grid-template-columns: 1fr 1fr;
          gap: 1.1rem;
        }

        .feature-image {
          height: 9.5rem;
        }

        .composer-input {
          font-size: 1.05rem;
          max-height: 7.6rem;
        }

        .cta {
          width: 2.95rem;
          height: 2.95rem;
        }
      }

      /* Tablet Landscape */
      @media (min-width: 720px) and (orientation: landscape) {
        /* .panel {
          max-width: 48rem;
        } */
        .hero-title {
          font-size: 3.3rem;
        }
      }

      @media (min-width: 656px) and (orientation: portrait) {
        /* .panel {
          max-width: 40rem;
        } */
        .hero-title {
          font-size: 3.2rem;
        }
      }

      /* Big Tablet Landscape */
      @media (min-width: 1000px) and (orientation: landscape) {
        /* .panel {
          max-width: 54rem;
        } */
        .hero-title {
          font-size: 3.6rem;
        }
        .feature-image {
          height: 10.5rem;
        }
      }

      /* Web portrait */
      @media (min-width: 846px) and (orientation: portrait) {
        /* .panel {
          max-width: 46rem;
        } */
        .hero-title {
          font-size: 3.7rem;
        }
      }

      /* web Landscape */
      @media (min-width: 1440px) and (orientation: landscape) {
        /* .panel {
          max-width: 58rem;
        } */
        .hero-title {
          font-size: 4rem;
        }
      }

      /* TV portrait */
      @media (min-width: 1080px) and (orientation: portrait) {
        .cta {
          width: 7.9rem;
          height: 7.9rem;
          padding: 0.49rem;
          border-radius: 0.99rem;
        }
        .cta svg {
          width: 2.96rem;
          height: 2.96rem;
        }
      }

      /* TV landscape */
      @media (min-width: 1920px) and (orientation: landscape) {
        .cta {
          width: 4.45rem;
          height: 4.45rem;
          padding: 0.28rem;
          border-radius: 0.56rem;
        }
        .cta svg {
          width: 1.67rem;
          height: 1.67rem;
        }
      }
    </style>
  </head>

  <body>
    <div id="loader" class="loader"></div>

    <main>
      <div>
        <h1 class="hero-title">SkinGPT</h1>
        <p class="hero-subtitle">Your AI skincare assistant</p>
      </div>

      <div class="panel">
        <div class="panel-inner">
          <div class="composer">
            <div class="composer-inner">
              <textarea
                class="composer-input"
                rows="1"
                placeholder="How can I help you today?"
              ></textarea>

              <div class="composer-bottom">
                <div class="chips">
                  <button class="suggestion-btn" type="button">
                    How do I improve my skin texture?
                  </button>
                  <button class="suggestion-btn" type="button">
                    Recommend a good moisturizer
                  </button>
                </div>

                <button class="cta" type="button" aria-label="Send">
                  <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path
                      d="M12 5v14m0-14l-6 6m6-6l6 6"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="panel-band">
          <div class="features-container">
            <div class="feature-card" id="analyze" role="button" tabindex="0">
              <img
                class="feature-image"
                id="analyzeImg"
                src="https://storage.googleapis.com/skinchat-core-dev-releases-asia-east1/0.5.1/br/dist/immutable/assets/analysis.ZSryxJbS.png"
                alt=""
              />
              <h3 class="feature-title">Analyze my skin</h3>
              <p class="feature-description">by taking a quick photo</p>
            </div>

            <div
              class="feature-card"
              id="personalise"
              role="button"
              tabindex="0"
            >
              <img
                class="feature-image"
                id="personaliseImg"
                src="https://storage.googleapis.com/skinchat-core-dev-releases-asia-east1/0.5.1/br/dist/immutable/assets/routine.CBHeyKkM.png"
                alt=""
              />
              <h3 class="feature-title">Build my personalized</h3>
              <p class="feature-description">skincare routine</p>
            </div>
          </div>
        </div>
      </div>

      <a
        href="/skin-portrait"
        class="skin-portrait-pill"
        aria-label="Skin Portrait"
      >
        <span class="skin-portrait-plus" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path
              d="M12 5v14M5 12h14"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
            />
          </svg>
        </span>
        <span class="skin-portrait-text">Skin Portrait</span>
      </a>
    </main>

    <div id="copilotContainer"><div id="copilotSA"></div></div>

    <script src="https://cdn.glamarz0.de/sdk/wrapper"></script>
    <script src="https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js"></script>

    <script type="application/javascript">
      const loader = document.getElementById("loader");
      let loaderAnimation = null;

      function initLoader() {
        if (!loader || loaderAnimation) return;

        loaderAnimation = lottie.loadAnimation({
          container: loader,
          renderer: "svg",
          loop: true,
          autoplay: true,
          width: "200px",
          height: "200px",
          path: "https://cdn.pixelbin.io/v2/dummy-cloudname/original/__glam_ar/__sdk/saloader_light.json",
        });
      }

      function showLoader() {
        initLoader();
        document.getElementById("loader")?.classList.add("active");
      }

      function hideLoader() {
        document.getElementById("loader")?.classList.remove("active");
      }

      async function showCopilot(
        userSettings = {
          hostId: "1234",
          email: "example@gmail.com",
          additionalFields: {},
        },
      ) {
        let copilotReady = false;
        showLoader();
        copilotContainer.style.display = "flex";

        (function (w, d, s, o, f, js, fjs) {
          w[o] =
            w[o] ||
            function () {
              (w[o].q = w[o].q || []).push(arguments);
            };
          js = d.createElement(s);
          fjs = d.getElementsByTagName(s)[0];
          js.id = o;
          js.src = f;
          js.async = 1;
          js.referrerPolicy = "origin";
          fjs.parentNode.insertBefore(js, fjs);
        })(
          window,
          document,
          "script",
          "copilot",
          "https://script.copilot.live/v1/copilot.min.js?tkn=cat-pnxlzhq8",
        );

        copilot(
          "init",
          { element: "copilotSA", position: "initial" },
          function () {
            try {
              window?.copilot?.users?.set?.(userSettings);
            } catch (e) {
              console.warn("users.set failed:", e);
            }
            copilotReady = true;
            hideLoader();
          },
        );

        while (!copilotReady) {
          await new Promise((resolve) => setTimeout(resolve, 50));
        }
        return copilotReady;
      }

      let glamAROverlay = null;
      let glamARContainer = null;
      const copilotContainer = document.getElementById("copilotContainer");
      const analyzeBtn = document.getElementById("analyze");
      const personaliseBtn = document.getElementById("personalise");
      const textarea = document.querySelector(".composer-input");
      const chips = document.querySelectorAll(".suggestion-btn");
      const sendBtn = document.querySelector(".cta");
      copilotContainer.style.display = "none";

      const setSendState = () => {
        const hasText = textarea.value.trim().length > 0;

        sendBtn.classList.toggle("is-active", hasText);
        sendBtn.classList.toggle("is-disabled", !hasText);
        sendBtn.disabled = !hasText;
      };

      setSendState();
      textarea.addEventListener("input", () => {
        autosize();
        setSendState();
      });

      const autosize = () => {
        textarea.style.height = "auto";
        const maxH = parseFloat(getComputedStyle(textarea).maxHeight);
        textarea.style.height = Math.min(textarea.scrollHeight, maxH) + "px";
      };

      autosize();
      textarea.addEventListener("input", autosize);

      chips.forEach((btn) => {
        btn.addEventListener("click", () => {
          textarea.value = btn.textContent.trim();
          textarea.focus();
          autosize();
        });
      });

      personaliseBtn.addEventListener("click", async () => {
        await showCopilot();
        copilot("event", "sendUserMessage", {
          value: "Build my personalized skincare routine",
        });
      });

      sendBtn.addEventListener("click", async () => {
        const message = textarea.value.trim();
        if (!message) return;

        await showCopilot();
        copilot("event", "sendUserMessage", { value: message });

        textarea.value = "";
        textarea.style.height = "auto";
        setSendState(); // <- add
      });

      analyzeBtn.addEventListener("click", () => {
        showGlamARSdk();
      });

      function ensureOverlay() {
        if (document.getElementById("glamarOverlay")) {
          glamAROverlay = document.getElementById("glamarOverlay");
          glamARContainer = document.getElementById("GlamAR-Container");
          return;
        }

        const overlay = document.createElement("div");
        overlay.id = "glamarOverlay";
        overlay.innerHTML = `
          <div id="glamarModal">
            <div id="GlamAR-Container"></div>
            <button id="closeSdkBtn" aria-label="Close">Ã—</button>
          </div>
        `;
        document.body.appendChild(overlay);

        glamAROverlay = overlay;
        glamARContainer = document.getElementById("GlamAR-Container");
      }

      function showGlamARSdk() {
        ensureOverlay();
        glamAROverlay.style.display = "flex";
        initGlamAr();
      }

      function closeGlamARSdk() {
        try {
          if (window.GlamAR && typeof window.GlamAR.close === "function")
            window.GlamAR.close();
        } catch (e) {}
        if (glamAROverlay) glamAROverlay.style.display = "none";
        if (glamARContainer)
          while (glamARContainer.firstChild)
            glamARContainer.removeChild(glamARContainer.firstChild);
        window.__GLAMAR_INITIALIZED__ = false;
      }

      function initGlamAr() {
        ensureOverlay();
        glamAROverlay.style.display = "flex";

        if (window.__GLAMAR_INITIALIZED__) return;
        if (!window.GlamAR || typeof window.GlamAR.init !== "function") {
          console.error("GlamAR wrapper missing");
          return;
        }
        showLoader();

        window.__GLAMAR_INITIALIZED__ = true;

        const config = {
          platform: "web",
          category: "skingpt",
          meta: { sdkVersion: "2.0.0" },
          configuration: {
            skinAnalysis: { appId: "fecf3bc7-c9ec-4c47-8555-98a74df58288" },
          },
        };

        window.GlamAR.init(
          "GlamAR-Container",
          "ba843e66-4b93-48f6-a02e-ea48d920e52e",
          config,
        );

        window.GlamAR.addEventListener?.("*", async (event, payload) => {
          if (event === "loading") hideLoader();
          if (event === "closed") closeGlamARSdk();

          if (event === "skin-gpt") {
            try {
              const {
                accessToken,
                scanId,
                predictionId,
                appId,
                subjectId,
                retouchPredictionId,
              } = payload || {};

              const userSettings = {
                hostId: subjectId,
                email: "example@gmail.com",
                additionalFields: {
                  predictionId,
                  scanId,
                  retouchPredictionId,
                  accessToken,
                  appId,
                },
              };

              await showCopilot(userSettings);
              closeGlamARSdk();
            } catch (e) {
              console.error("Error handling skin-gpt:", e);
            }
          }
        });
      }
    </script>
  </body>
</html>
